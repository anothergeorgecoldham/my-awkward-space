---
import { siteConfig } from "../config/content";
import IconMark from "./IconMark.astro";

const pathname = Astro.url?.pathname ?? "/";

const navItems = [
  { href: "/", label: "Home" },
  { href: "/posts/", label: "Posts" },
  { href: "/projects/", label: "Projects" },
  { href: "/about/", label: "About" },
  { href: "/links/", label: "Links" },
];

function isActive(href) {
  if (href === "/") return pathname === "/";
  return pathname.startsWith(href);
}
---

<nav class="relative z-50">
  <div class="mx-auto w-full max-w-5xl px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <!-- Brand -->
      <a href="/" class="flex items-center gap-3 group">
        <span
          class="inline-flex h-9 w-9 items-center justify-center rounded-lg
                 border border-neutral-300/70 bg-white/60
                 dark:border-neutral-700/70 dark:bg-neutral-900/40"
        >
          <span class="text-neutral-900 dark:text-neutral-100">
            <IconMark class="h-6 w-6" title={siteConfig.name} />
          </span>
        </span>
        <span class="font-semibold tracking-tight text-neutral-800 dark:text-neutral-200 group-hover:text-neutral-600 dark:group-hover:text-neutral-100 transition-colors">
          {siteConfig.name}
        </span>
      </a>

      <!-- Desktop nav -->
      <div class="hidden md:flex items-center gap-2">
        {navItems.map((item) => (
          <a
            href={item.href}
            aria-current={isActive(item.href) ? "page" : undefined}
            class={
              "px-3 py-2 rounded-lg text-sm font-medium transition-colors border " +
              (isActive(item.href)
                ? "text-neutral-900 dark:text-neutral-100 bg-white/60 dark:bg-neutral-900/40 border-neutral-300/70 dark:border-neutral-700/70"
                : "text-neutral-600 hover:text-neutral-900 dark:text-neutral-400 dark:hover:text-neutral-100 border-transparent hover:bg-white/40 dark:hover:bg-neutral-900/30")
            }
          >
            {item.label}
          </a>
        ))}

        <div class="ml-2 pl-3 border-l border-neutral-200/60 dark:border-neutral-800/60"></div>

        <!-- Theme toggle -->
        <button
          id="theme-toggle"
          class="p-2 rounded-lg text-neutral-600 hover:text-neutral-900
                 dark:text-neutral-400 dark:hover:text-neutral-100
                 hover:bg-white/40 dark:hover:bg-neutral-900/30 transition-colors"
          aria-label="Toggle dark mode"
          type="button"
        >
          <svg class="w-5 h-5 theme-icon-light hidden" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1z" />
          </svg>
          <svg class="w-5 h-5 theme-icon-dark hidden" fill="currentColor" viewBox="0 0 20 20">
            <path d="M17.293 13.293A8 8 0 016.707 2.707a8 8 0 1010.586 10.586z" />
          </svg>
        </button>
      </div>
    </div>
  </div>
</nav>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const toggle = document.getElementById("theme-toggle");
    if (!toggle) return;

    const light = toggle.querySelector(".theme-icon-light");
    const dark = toggle.querySelector(".theme-icon-dark");

    const sync = () => {
      const isDark = document.documentElement.classList.contains("dark");
      light.classList.toggle("hidden", isDark);
      dark.classList.toggle("hidden", !isDark);
    };

    sync();

    toggle.addEventListener("click", () => {
      document.documentElement.classList.toggle("dark");
      localStorage.setItem(
        "theme",
        document.documentElement.classList.contains("dark") ? "dark" : "light"
      );
      sync();
    });
  });
</script>
